<div class="container"><div class="admin-container">
  <div class="admin-header">
    <div class="admin-header-title">
      <i class="bi bi-camera-video admin-header-icon"></i> الفيديوهات
    </div>
  </div>
</div>

  <div class="admin-nav-tabs">
  
    <a routerLink="/admin/courses" routerLinkActive="active">
      <i class="bi bi-book"></i> الكورسات
    </a>
    <a routerLink="/admin/videos" routerLinkActive="active" class="active">
      <i class="bi bi-camera-video"></i> الفيديوهات
    </a>
    <a routerLink="/admin/quizzes" routerLinkActive="active">
      <i class="bi bi-patch-question"></i> الكويزات
    </a>
    <a routerLink="/admin/assign" routerLinkActive="active">
      <i class="bi bi-person-plus"></i> تعيين كورس
    </a>
  </div>

  <div *ngIf="errorMsg" class="admin-alert admin-alert-danger">
    <i class="bi bi-exclamation-triangle admin-alert-icon"></i>
    <div>{{ errorMsg }}</div>
  </div>
  <div *ngIf="successMsg" class="admin-alert admin-alert-success">
    <i class="bi bi-check-circle admin-alert-icon"></i>
    <div>{{ successMsg }}</div>
  </div>

  <div class="admin-card admin-mb-4">
    <div class="admin-card-header">
      <i class="bi bi-plus-circle admin-card-header-icon"></i>
      إضافة فيديو إلى كورس
    </div>
    <div class="admin-card-body">
      <form [formGroup]="form" (ngSubmit)="submit()">
        <div class="admin-form-group mb-3">
          <label class="admin-form-label">الكورس *</label>
          <select class="form-select admin-form-select" formControlName="courseId" (change)="onCourseChange($event)">
            <option *ngFor="let c of courses" [value]="c.courseId">{{ c.courseName }}</option>
          </select>
        </div>
        <div class="admin-form-group mb-3">
          <label class="admin-form-label">عنوان الفيديو *</label>
          <input class="form-control admin-form-control" formControlName="videoTitle" />
        </div>

        <div class="admin-form-group mb-3">
          <label class="admin-form-label d-block">طريقة الإضافة</label>
          <div class="admin-form-check admin-form-check-inline admin-videos-radio-spacing">
            <input class="admin-form-check-input" type="radio" name="srcType" [checked]="sourceType==='link'" (change)="setSource('link')" />
            <label class="admin-form-check-label">رابط خارجي</label>
          </div>
          <br>
          <div class="admin-form-check admin-form-check-inline admin-videos-radio-spacing">
            <input class="admin-form-check-input" type="radio" name="srcType" [checked]="sourceType==='file'" (change)="setSource('file')" />
            <label class="admin-form-check-label">رفع من الجهاز</label>
          </div>
        </div>

        <div *ngIf="sourceType==='link'" class="admin-form-group mb-3">
          <label class="admin-form-label">رابط الفيديو</label>
          <input class="form-control admin-form-control" formControlName="videoUrl" />
        </div>
        <div *ngIf="sourceType==='file'" class="admin-form-group mb-3">
          <label class="admin-form-label">ملف الفيديو</label>
          <input class="form-control admin-form-control" type="file" accept="video/*" (change)="onVideoSelected($event)" />
          <small class="form-text text-muted">ملاحظة: قد تستغرق عملية رفع مقاطع الفيديو الكبيرة بعض الوقت. يُنصح بضغط الفيديو قبل الرفع لتقليل وقت المعالجة.</small>
        </div>

        <div class="row admin-gap-3">
          <div class="col-md-6">
            <div class="admin-form-group mb-3">
              <label class="admin-form-label">المدة (دقائق)</label>
              <input class="form-control admin-form-control" type="number" formControlName="duration" />
            </div>
          </div>
          <div class="col-md-6">
            <div class="admin-form-group mb-3">
              <label class="admin-form-label">الترتيب</label>
              <input class="form-control admin-form-control" type="number" formControlName="orderIndex" />
            </div>
          </div>
        </div>

        <div class="admin-card-footer d-flex justify-content-end">
          <button class="admin-btn admin-btn-secondary" type="submit" [disabled]="form.invalid || loading">إضافة فيديو</button>
        </div>
        
        <!-- Loading animation for video upload -->
        <div *ngIf="loading" class="admin-upload-loading">
          <div class="admin-spinner"></div>
          <p class="admin-upload-text">جاري رفع الفيديو... يرجى الانتظار</p>
          <p class="admin-upload-subtext">قد يستغرق هذا بعض الوقت حسب حجم الملف</p>
        </div>
      </form>
    </div>
  </div>

  <div *ngIf="selectedCourseId" class="admin-card">
    <div class="admin-card-header">
      <i class="bi bi-list admin-card-header-icon"></i>
      الفيديوهات في هذا الكورس <span class="admin-badge admin-badge-primary ms-2">{{ videos.length }}</span>
    </div>
    <div class="admin-card-body">
      <div *ngIf="!videos.length" class="admin-text-muted">لا توجد فيديوهات.</div>
      <div class="admin-grid" *ngIf="videos.length">
        <div *ngFor="let v of videos" class="admin-card admin-mb-3">
          <div class="admin-card-body">
            <div class="row admin-gap-2">
              <div class="col-md-4 admin-form-group"><label class="admin-form-label">العنوان</label><input class="form-control admin-form-control" [(ngModel)]="v.title" name="title-{{v.id}}" /></div>
              <div class="col-md-4 admin-form-group"><label class="admin-form-label">الرابط</label><input class="form-control admin-form-control" [(ngModel)]="v.url" name="url-{{v.id}}" /></div>
              <div class="col-md-2 admin-form-group"><label class="admin-form-label">المدة</label><input class="form-control admin-form-control" type="number" [(ngModel)]="v.duration" name="dur-{{v.id}}" /></div>
              <div class="col-md-2 admin-form-group"><label class="admin-form-label">الترتيب</label><input class="form-control admin-form-control" type="number" [(ngModel)]="v.orderIndex" name="ord-{{v.id}}" /></div>
            </div>
          </div>
          <div class="admin-card-footer d-flex gap-2">
            <button class="admin-btn admin-btn-primary" (click)="updateVideo(v)" [disabled]="loading" [class.admin-btn-loading]="loading">
              <span *ngIf="loading; else updateText">جاري التحديث...</span>
              <ng-template #updateText>تحديث</ng-template>
            </button>
            <button class="admin-btn admin-btn-danger" (click)="deleteVideo(v.id)" [disabled]="loading" [class.admin-btn-loading]="loading">
              <span *ngIf="loading; else deleteText">جاري الحذف...</span>
              <ng-template #deleteText>حذف</ng-template>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
